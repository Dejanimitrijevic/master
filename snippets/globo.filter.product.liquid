{% comment %} Do not edit this file {% endcomment %}
{% raw %}
  {% assign root_url = {% endraw %}"{%- if routes.root_url != "/" -%}{{ routes.root_url }}{%- endif -%}"{% raw %} %}
  {% assign currencyFormat = {% endraw %}{{ shop.money_format | json }}{% raw %} %}
  {% assign swatch_options = '' | downcase | replace: ', ', ',' | split: ","  %}
  {% assign image_options  = '' | downcase | replace: ', ', ',' | split: ","  %}
  {% assign text_options   = '' | downcase | replace: ', ', ',' | split: ","  %}
  {% assign show_selected_variant_info = true %}

  {% assign image_size     = '360x504' %}
  {% assign images_count   = product.images | size %}
  {% assign variants_count = product.variants | size %}
  {% assign options_count  = product.options | size %}
  {% assign no_image = 'https://cdn.shopify.com/s/images/themes/product-1.png' %}

  {% assign featured_image            = product.featured_image %}
  {% assign product_price             = product.price %}
  {% assign product_compare_at_price  = product.compare_at_price %}
  {% assign second_image_index        = 2 %}
  {% assign selected_or_first_available_variant = product.selected_or_first_available_variant %}

  {% if show_selected_variant_info and product.selected_variant %}
    {% assign selected_or_first_available_variant = product.selected_variant %}
    {% assign product_price             = selected_or_first_available_variant.price %}
    {% assign product_compare_at_price  = selected_or_first_available_variant.compare_at_price %}
    {% if selected_or_first_available_variant.image %}
      {% assign featured_image  = selected_or_first_available_variant.image %}
    {% endif %}
    {% for image in product.images %}
      {% if image.id == featured_image.id %}
        {% if forloop.index == images_count %}
          {% assign second_image_index = 1 %}
        {% else %}
          {% assign second_image_index = forloop.index | plus: 1 %}
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}

            {% if section.settings.layout == 'rows' %}
  {% if section.settings.grid == 2 %}
  {% assign product_class = 'column half' %}
  {% elsif section.settings.grid == 3 %}
  {% assign product_class = 'column third' %}
  {% else %}
  {% assign product_class = 'column quarter' %}
  {% endif %}
  {% endif %}

  {% assign i = forloop.index %}
  {% assign show_vendor = section.settings.show_vendor %}
  {% assign show_alt_pricing = section.settings.show_alternative_pricing %}
  {% assign show_alt_pricing_over_price = section.settings.show_alternative_pricing_over_price %}

  {% assign on_sale = false %}
  {% if product.compare_at_price > product.price %}
  {% assign on_sale = true %}
  {% endif %}

  {% assign product_url = product.url | within: collection %}

  {% if animation_type == blank %}
  {% assign animation_type = "cc-fade-in-up" %}
  {% endif %}

  {% assign primary_image = product.featured_image %}
  {% assign secondary_image = product.images[1] %}

  {% assign product_has_swatches = false %}
  {% if settings.swatch_enabled and settings.prod_block_swatches and hide_swatches != true %}
  {% for product_option in product.options %}
  {% if settings.swatch_option_name == product_option.name %}
  {% assign product_has_swatches = true %}
  {% break %}
  {% endif %}
  {% endfor %}
  {% endif %}

  <div class="product-block
    cc-product-block
    {% unless product.available %} sold-out{% endunless %}
    {% if on_sale %} on-sale{% endif %}
    {% if settings.prod_hover == "second_image" %}hover-image{% endif %}
    {% if settings.prod_hover == "all_images" and images_count > 1 %}all-images{% endif %}
    {% if product.tags contains 'meta-layout-right' %}layout-right{% endif %}
    {% if settings.prod_label_layout == 'marquee_on_hover' %} product-block--marquee-on-hover {% endif%}
    {% if settings.quickbuy_enabled %}product-block--quickbuy{% endif %}
    {% if product_has_swatches %}product-block--has-swatches{% endif %}
    {{ product_class }}"
      data-test=""
      data-loop-index="{{ i }}"
    {% if animate %} data-cc-animate="{{ animation_type }}" data-cc-animate-delay="{{ animate | times: 0.15 }}s" {% endif %}

    {% if images_count > 1 %}
      {% if settings.prod_hover == "all_images" or product_has_swatches %}
        {% assign images = "" %}
        {% for image in product.images %}
        {% assign image_placeholder = image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' %}
        {% assign images = images | append: "," | append: image_placeholder %}
        {% endfor %}
        data-product-images="{{ images | remove_first: "," }}"
      {% endif %}
    {% endif %}
  >

    <div class="product-block__inner">
            <div class="image {% if settings.prod_hover == "second_image" and images_count > 1 %}image--hover-second {% if primary_image.aspect_ratio == secondary_image.aspect_ratio %}image--same-aspect-ratio{% endif %}{% endif %}">
        {% if settings.prod_label_layout contains 'marquee' %}
          <div class="product-marquee">
            {% assign num_labels_reps = 20 %}
            {% if product.available == false and settings.show_sold_out_label %}
            <span class="product-label unavailable
                        {% if settings.prod_label_layout == 'marquee' or settings.prod_label_layout == 'marquee_on_hover' %}product-label--marquee{% endif %}
                        {% if settings.prod_label_layout == 'marquee_on_hover' %}product-label--marquee-on-hover{% endif %}">

              <span>{% endraw %}{{ 'products.listing.sold_out' | t }}{% raw %}</span>
              {% if settings.prod_label_layout == 'marquee' or settings.prod_label_layout == 'marquee_on_hover' %}
              {% for i in (1..num_labels_reps) %}
              <span>{% endraw %}{{ 'products.listing.sold_out' | t }}{% raw %}</span>
              {% endfor %}
              {% endif %}
            </span>
            {% elsif product.compare_at_price > product.price and settings.show_sale_label %}
            <span class="product-label sale
                        {% if settings.prod_label_layout == 'marquee' or settings.prod_label_layout == 'marquee_on_hover' %}product-label--marquee{% endif %}
                        {% if settings.prod_label_layout == 'marquee_on_hover' %}product-label--marquee-on-hover{% endif %}">

              <span>{% endraw %}{{ 'products.product.sale' | t }}{% raw %}</span>
              {% if settings.prod_label_layout == 'marquee' or settings.prod_label_layout == 'marquee_on_hover' %}
              {% for i in (1..num_labels_reps) %}
              <span>{% endraw %}{{ 'products.product.sale' | t }}{% raw %}</span>
              {% endfor %}
              {% endif %}
            </span>
            {%- elsif settings.show_new_label -%}

            {%- assign show_new_in = false -%}
            {%- if settings.show_new_label -%}
            {%- if settings.prod_new_method == 'date' -%}
            {%- assign now_s = 'now' | date: '%s' | plus: 0 -%}
            {%- assign pub_s = product.created_at | date: '%s' | plus: 0 -%}
            {%- assign diff_days = now_s | minus: pub_s | divided_by: 86400 -%}

            {%- if diff_days < settings.prod_new_limit_int -%}
            {%- assign show_new_in = true -%}
            {%- endif -%}
            {%- elsif settings.prod_new_method == 'tag' -%}
            {%- if product.tags contains 'New' -%}
            {%- assign show_new_in = true -%}
            {%- endif -%}
            {%- else -%}
            {%- for collection in product.collections -%}
            {%- assign split_collection_handle = collection.handle | split: '-' -%}
            {%- if split_collection_handle contains 'new' -%}
            {%- assign show_new_in = true -%}
            {%- break -%}
            {%- endif -%}
            {%- endfor -%}
            {%- endif -%}
            {%- endif -%}

            {%- if show_new_in -%}
            <span class="product-label product-label--new
                        {% if settings.prod_label_layout == 'marquee' or settings.prod_label_layout == 'marquee_on_hover' %}product-label--marquee{% endif %}
                        {% if settings.prod_label_layout == 'marquee_on_hover' %}product-label--marquee-on-hover{% endif %}">
              <span>{% endraw %}{{ 'products.labels.new_in' | t }}{% raw %}</span>
              {% if settings.prod_label_layout == 'marquee' or settings.prod_label_layout == 'marquee_on_hover' %}
              {% for i in (1..num_labels_reps) %}
              <span>{% endraw %}{{ 'products.labels.new_in' | t }}{% raw %}</span>
              {% endfor %}
              {% endif %}
            </span>
            {%- endif -%}
            {% endif %}
          </div>
        {% endif %}

        <a class="spf-product-card__image-wrapper{% if images_count > 1 %} hover-effect{% endif %}" href="{{root_url}}{{ product.url | within: collection }}" >
              {% if images_count > 0 %}
                {% for image in product.images %}
                  <img
                    data-variants="{% if image.variant_ids %}{{image.variant_ids | join: ','}}{% endif %}"
                    class="gflazyload spf-product-card__image spf-product-card__image-{% if featured_image.id == image.id %}main{% elsif forloop.index == second_image_index %}secondary{% else %}hidden{% endif %}"
                    srcset="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
                    src="{{image.src | img_url: image_size}}"
                    data-src="{{image.src | img_lazyload_url}}"
                    data-sizes="auto"
                    data-aspectratio="{{image.aspect_ratio}}"
                    data-parent-fit="contain"
                    alt="{{image.alt | escape}}"
                    />
                {% endfor %}
              {% else %}
              <img data-variants="" class="gflazyload spf-product-card__image spf-product-card__image-main" src="{{no_image}}" alt="{{product.title | escape}}">
              {% endif %}
            </a>

      </div>

      {%- if settings.swatch_enabled and settings.prod_block_swatches and hide_swatches != true -%}
        {%- assign option_limit = 3 -%}
        {%- for product_option in product.options -%}
          {%- if settings.swatch_option_name == product_option.name -%}
            <ul class="cc-swatches {% if settings.swatch_use_prod_images == true %}cc-swatches-prod-img cc-swatches-prod-img-{{ settings.swatch_prod_images_shape }}{% endif %}" data-option-name="{{ product_option.name | escape }}">
              {%- if options_count == 1 -%}
                {%- for variant in product.variants -%}
                  {%- assign variant_image = variant.image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' -%}
                  {% if forloop.index <= option_limit %}
                    <li>
                      <a rel="nofollow"
                        href="{{ product.url }}?variant={{ variant.id }}"
                        title="{{ variant.title | escape }}"
                        {% if variant.image %}
                        data-variant-image="{{ variant_image }}"
                        {% endif %}
                          class="{% unless variant.available %}unavailable{% endunless %} lazyload"
                            data-option-item="{{ variant.title | downcase | escape }}"
                            {% if variant.image %}data-media="{{ variant.id }}"{% endif %}
                      {% if settings.swatch_method == "image" and settings.swatch_use_prod_images == false  %}
                        data-bgset="{{ variant.title | handle | append: '.png' | file_img_url: '48x48', crop: 'center' }}"
                      {% elsif settings.swatch_use_prod_images == true %}
                        data-bgset="{{ variant.image | img_url: '72x', crop: 'center' }}"
                        style="{% if settings.swatch_prod_images_shape == "natural" %}padding-top: {{ 1 | divided_by: variant.image.aspect_ratio | times: 100 }}%;{% endif %}"
                      {% else %}
                        style="background-color:{{ variant.title | downcase | remove: ' ' | escape }}"
                      {% endif %}>
                        {{ variant.title }}
                    </a>
                    </li>
                  {% endif %}
                {%- endfor -%}
                {%- if variants_count > option_limit -%}
                  <li class="product-block__more-label"><span>&plus;{{ variants_count | minus: option_limit }}</span></li>
                {%- endif -%}
              {%- else -%}
                {%- assign product_option_position_0index = product_option.position | minus: 1 -%}
                {%- for product_option_value in product_option.values -%}
                
                    {%- assign option_value_variant = false -%}
                    {%- assign is_unavailable = true -%}
                    {%- for variant in product.variants -%}
                    {%- if variant.options[product_option_position_0index] == product_option_value -%}
                    {%- assign option_value_variant = variant -%}
                    {%- break -%}
                    {%- endif -%}
                    {%- endfor -%}
                    {%- for variant in product.variants -%}
                    {%- if variant.available and variant.options[product_option_position_0index] == product_option_value -%}
                    {%- assign is_unavailable = false -%}
                    {%- break -%}
                    {%- endif -%}
                    {%- endfor -%}
                    {%- assign variant_image = option_value_variant.image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' -%}
                  
                  {% if forloop.index <= option_limit %}
                    <li>
                      <a rel="nofollow"
                        href="{{ product.url }}?variant={{ option_value_variant.id }}"
                        title="{{ product_option_value | escape }}"
                        class="{% if is_unavailable %} unavailable{% endif %} lazyload"
                        {% if option_value_variant.image %}
                          data-variant-image="{{ variant_image }}"
                        {% endif %}
                          data-option-item="{{ product_option_value | downcase | escape }}"
                          {% if option_value_variant.image %}data-media="{{ option_value_variant.id }}"{% endif %}
                        {% if settings.swatch_method == "image" and settings.swatch_use_prod_images == false  %}
                          data-bgset="{{ product_option_value | handle | append: '.png' | file_img_url: '48x48', crop: 'center' }}"
                        {% elsif settings.swatch_use_prod_images == true %}
                          data-bgset="{{ option_value_variant.image | img_url: '72x', crop: 'center' }}"
                          style="{% if settings.swatch_prod_images_shape == "natural" %}padding-top: {{ 1 | divided_by: option_value_variant.image.aspect_ratio | times: 100 }}%;{% endif %}"
                        {% else %}
                          style="background-color:{{ product_option_value | downcase | remove: ' ' | escape }}"
                        {% endif %}>
                          {{ product_option_value }}
                      </a>
                    </li>
                  {% endif %}
                {%- endfor -%}
                {% assign product_option_size = product_option.values | size %}
                {%- if product_option_size > option_limit -%}
                  <li class="product-block__more-label"><span>&plus;{{ product_option_size | minus: option_limit }}</span></li>
                {%- endif -%}
              {%- endif -%}
            </ul>
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}

      {%- if settings.quickbuy_enabled -%}
        <div class="cc-quick-buy-btn-container">
          <a href="{{ product_url }}" data-cc-quick-buy class="button alt cc-quick-buy-btn">
            {% endraw %}{{ 'products.listing.quick_view' | t }}{% raw %}
          </a>
        </div>
      {%- endif -%}

      <a data-cc-animate-click href="{{ product_url }}" class="caption upper">
        <span class="title">{{ product.title }}</span>

        {% if show_vendor %}
          <span class="vendor">{{ product.vendor }}</span>
        {% endif %}
        {% assign alt_pricing_field = product.metafields.my_fields.pris_per_kvm %}
        {% if show_alt_pricing and alt_pricing_field.value != blank and show_alt_pricing_over_price %}
        <div class="price">
          <!-- CRGGR Test comment -->
          <span class="theme-money">{{ alt_pricing_field.value }}</span>
        </div>
        {% else %}
        <div class="price">
          {% if product.price_varies %}{% endraw %}{{ 'products.listing.from' | t }}{% raw %}{% endif %}
          <span class="theme-money">{{ product.price | money }}</span>
          {% if on_sale %}<span class="was-price theme-money">{{ product.compare_at_price | money }}</span>{% endif %}
        </div>
        {% endif %}
        {% if show_alt_pricing and alt_pricing_field.value != blank and show_alt_pricing_over_price == false %}
        <div class="price">
          <span class="theme-money">{{ alt_pricing_field.value }}</span>
        </div>
        {% endif %}
      </a>

      {% if settings.show_product_block_reviews %}
      <a data-cc-animate-click href="{{ product_url }}" class="themed-product-reviews" tabindex="-1">
        <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
      </a>
      {% endif %}
          </div>
  </div>
      {% endraw %}
